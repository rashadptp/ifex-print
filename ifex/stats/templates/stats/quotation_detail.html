{% extends "base.html" %}

{% block title %}Quotation {{ quotation.quotation_number }} - IFEX PR{% endblock %}

{% block extra_css %}
<style>
    .quotation-header {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        padding: 32px;
        border-radius: 16px;
        margin-bottom: 32px;
        position: relative;
        overflow: hidden;
    }
    
    .quotation-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 100%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(15deg);
        pointer-events: none;
    }
    
    .header-content {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 24px;
        align-items: center;
    }
    
    .quotation-info h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .quotation-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 0;
    }
    
    .status-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .details-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }
    
    .detail-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        border: 1px solid var(--border-color);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }
    
    .detail-card:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .card-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .card-title i {
        color: var(--accent-blue);
    }
    
    .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .detail-item:last-child {
        border-bottom: none;
    }
    
    .detail-label {
        color: var(--text-gray);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .detail-label i {
        font-size: 0.9rem;
        width: 16px;
    }
    
    .detail-value {
        color: var(--text-dark);
        font-weight: 600;
        text-align: right;
    }
    
    .detail-value.customer {
        color: var(--accent-blue);
        font-size: 1.1rem;
    }
    
    .detail-value.date {
        font-family: 'Courier New', monospace;
        background: rgba(59, 130, 246, 0.1);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.9rem;
    }
    
/* Items Table - Responsive Styles */
.items-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
    display: table; /* Ensures table layout by default */
}

/* Mobile styles (under 768px) */
@media (max-width: 768px) {
    .items-table {
        display: block;
    }
    
    .items-table thead {
        display: none;
    }
    
    .items-table tbody,
    .items-table tr,
    .items-table td {
        display: block;
        width: 100%;
    }
    
    .items-table tr {
        position: relative;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .items-table td {
        padding: 8px 16px;
        text-align: right !important;
        position: relative;
        padding-left: 50%;
    }
    
    .items-table td::before {
        content: attr(data-label);
        position: absolute;
        left: 16px;
        width: 45%;
        padding-right: 10px;
        font-weight: 600;
        color: var(--primary-color);
        text-align: left;
    }
    
    .item-name {
        white-space: normal;
        word-break: break-word;
        text-align: right;
        display: inline-block;
        width: 100%;
    }
}

/* Desktop styles (769px and up) */
@media (min-width: 769px) {
    .items-table {
        display: table;
    }
    
    .items-table thead {
        display: table-header-group;
    }
    
    .items-table tbody {
        display: table-row-group;
    }
    
    .items-table tr {
        display: table-row;
    }
    
    .items-table td,
    .items-table th {
        display: table-cell;
        padding: 16px 20px;
    }
    
    /* Reset mobile-specific styles */
    .items-table td::before {
        display: none;
    }
    
    /* Desktop-specific alignment */
    .items-table th {
        text-align: left;
    }
    
    .items-table th:last-child,
    .items-table td:last-child {
        text-align: right;
    }
    
    .items-table td:nth-child(2),
    .items-table td:nth-child(3) {
        text-align: center;
    }
    
    .item-name {
        max-width: 300px; /* Adjust as needed */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .item-quantity {
        text-align: center;
        font-weight: 500;
        color: var(--accent-blue);
        background: rgba(59, 130, 246, 0.1);
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        min-width: 40px;
    }
    
    .item-price, .item-total {
        font-family: 'Courier New', monospace;
        font-weight: 600;
    }
    
    .item-price {
        color: var(--text-gray);
        text-align: center;
    }
    
    .item-total {
        color: var(--accent-green);
        background: rgba(16, 185, 129, 0.1);
        padding: 4px 8px;
        border-radius: 4px;
        text-align: right;
    }
}
    
    /* Summary Section */
    .summary-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        border: 1px solid var(--border-color);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        margin-bottom: 24px;
    }
    
    .summary-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .summary-title i {
        color: var(--accent-green);
    }
    
    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .summary-row:last-child {
        border-bottom: none;
        background: rgba(16, 185, 129, 0.05);
        padding: 16px 20px;
        margin: 16px -4px -4px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 1.1rem;
    }
    
    .summary-label {
        color: var(--text-gray);
        font-weight: 500;
    }
    
    .summary-value {
        font-family: 'Courier New', monospace;
        font-weight: 600;
        color: var(--text-dark);
    }
    
    .summary-row:last-child .summary-label,
    .summary-row:last-child .summary-value {
        color: var(--accent-green);
    }
    
    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 24px;
    }
    
    .action-btn {
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
    }
    
    .action-btn:hover {
        transform: translateY(-1px);
        text-decoration: none;
    }
    
    .btn-primary {
        background: var(--accent-blue);
        color: white;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
    }
    
    .btn-primary:hover {
        background: #2563eb;
        color: white;
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }
    
    .btn-success {
        background: var(--accent-green);
        color: white;
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
    }
    
    .btn-success:hover {
        background: #059669;
        color: white;
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
    }
    
    .btn-outline {
        background: transparent;
        color: var(--text-gray);
        border: 1px solid var(--border-color);
    }
    
    .btn-outline:hover {
        background: var(--light-gray);
        color: var(--text-dark);
        border-color: var(--text-gray);
    }
    
    .btn-warning {
        background: var(--accent-orange);
        color: white;
        box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
    }
    
    .btn-warning:hover {
        background: #d97706;
        color: white;
        box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
    }
    
    /* Back Navigation */
    .back-nav {
        margin-bottom: 24px;
    }
    
    .back-link {
        color: var(--text-gray);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .back-link:hover {
        color: var(--accent-blue);
        text-decoration: none;
        transform: translateX(-4px);
    }
    
    /* Mobile Responsive */
    @media (max-width: 992px) {
        .details-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .header-content {
            grid-template-columns: 1fr;
            text-align: center;
            gap: 16px;
        }
        
        .quotation-info h1 {
            font-size: 2rem;
        }
    }
    
    @media (max-width: 768px) {
        .quotation-header {
            padding: 24px 20px;
        }
        
        .detail-card {
            padding: 20px;
        }
        
        .items-table {
            font-size: 0.85rem;
        }
        
        .items-table th,
        .items-table td {
            padding: 12px 16px;
        }
        
        .items-header {
            padding: 16px 20px;
        }
        
        .summary-section {
            padding: 20px;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .action-btn {
            justify-content: center;
        }
    }
    
    @media (max-width: 480px) {
        .quotation-info h1 {
            font-size: 1.75rem;
        }
        
        .items-table {
            font-size: 0.8rem;
        }
        
        .items-table th,
        .items-table td {
            padding: 10px 12px;
        }
        
        .detail-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
        }
        
        .detail-value {
            text-align: left;
        }
    }
    
    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .detail-card, .items-section, .summary-section {
        animation: fadeInUp 0.4s ease-out;
    }
    
    .detail-card:nth-child(1) { animation-delay: 0.1s; }
    .detail-card:nth-child(2) { animation-delay: 0.2s; }
    .items-section { animation-delay: 0.3s; }
    .summary-section { animation-delay: 0.4s; }
    
    /* Print Styles */
    @media print {
        .action-buttons,
        .back-nav,
        .navbar,
        .footer {
            display: none !important;
        }
        
        .quotation-header {
            background: #f8f9fa !important;
            color: #333 !important;
            border: 1px solid #ddd;
        }
        
        .detail-card,
        .items-section,
        .summary-section {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Back Navigation -->
<div class="back-nav">
    <a href="{% url 'quotation_list' %}" class="back-link">
        <i class="fas fa-arrow-left"></i>
        Back to Quotations
    </a>
</div>

<!-- Quotation Header -->
<div class="quotation-header">
    <div class="header-content">
        <div class="quotation-info">
            <h1>Quotation No.: {{ quotation.quotation_number }}</h1>
            <p class="quotation-subtitle">Professional quotation for {{ quotation.customer.name }}</p>
        </div>
        <div class="status-badge">
            {% if quotation.invoices.exists %}
                <i class="fas fa-check-circle"></i>
                Invoiced
            {% else %}
                <i class="fas fa-clock"></i>
                Pending
            {% endif %}
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="action-buttons">
    <a href="{% url 'quotation_edit' quotation.id %}" class="action-btn btn-primary">
        <i class="fas fa-edit"></i>
        Edit Quotation
    </a>
    
    {% if quotation.invoices.exists %}
        <a href="{% url 'edit_invoice' quotation.invoices.first.id %}" class="action-btn btn-success">
            <i class="fas fa-file-invoice-dollar"></i>
            Edit Invoice
        </a>
    {% else %}
        <a href="{% url 'create_invoice' quotation.id %}" class="action-btn btn-success">
            <i class="fas fa-file-invoice"></i>
            Create Invoice
        </a>
    {% endif %}
    
    <a href="{% url 'quotation_pdf' quotation.id %}" class="action-btn btn-warning">
        <i class="fas fa-file-pdf"></i>
        Download PDF
    </a>
    
    <button onclick="window.print()" class="action-btn btn-outline">
        <i class="fas fa-print"></i>
        Print
    </button>
</div>

<!-- Details Grid -->
<div class="details-grid">
    <!-- Customer Information -->
    <div class="detail-card">
        <h3 class="card-title">
            <i class="fas fa-user"></i>
            Customer Information
        </h3>
        
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-building"></i>
                Customer Name
            </span>
            <span class="detail-value customer">{{ quotation.customer.name }}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-envelope"></i>
                Address
            </span>
            <span class="detail-value">{{ quotation.customer.address }}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-envelope"></i>
                City
            </span>
            <span class="detail-value">{{ quotation.customer.city }}</span>
        </div>
        
        {% if quotation.customer.email %}
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-envelope"></i>
                Email
            </span>
            <span class="detail-value">{{ quotation.customer.email }}</span>
        </div>
        {% endif %}
        
        {% if quotation.customer.phone %}
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-phone"></i>
                Phone
            </span>
            <span class="detail-value">{{ quotation.customer.phone }}</span>
        </div>
        {% endif %}
        
        <!-- {% if quotation.customer.address %}
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-map-marker-alt"></i>
                Address
            </span>
            <span class="detail-value">{{ quotation.customer.address }}</span>
        </div>
        {% endif %} -->
    </div>
    
    <!-- Quotation Details -->
    <div class="detail-card">
        <h3 class="card-title">
            <i class="fas fa-info-circle"></i>
            Quotation Details
        </h3>
        
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-hashtag"></i>
                Quotation #
            </span>
            <span class="detail-value">{{ quotation.quotation_number }}</span>
        </div>
        
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-calendar-plus"></i>
                Created Date
            </span>
            <span class="detail-value date">{{ quotation.created_at|date:"M d, Y" }}</span>
        </div>
        
        {% if quotation.expected_delivery_date %}
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-calendar-check"></i>
                Expected Delivery
            </span>
            <span class="detail-value date">{{ quotation.expected_delivery_date|date:"M d, Y" }}</span>
        </div>
        {% endif %}
        
        {% if quotation.payment_term %}
        <div class="detail-item">
            <span class="detail-label">
                <i class="fas fa-credit-card"></i>
                Payment Terms
            </span>
            <span class="detail-value">{{ quotation.payment_term|truncatewords:5 }}</span>
        </div>
        {% endif %}
    </div>
</div>

<!-- Items Section -->
<div class="items-section">
    <div class="items-header">
        <h3>
            <i class="fas fa-list"></i>
            Quotation Items
        </h3>
    </div>
    
    <table class="items-table">
    <thead>
        <tr>
            <th>Item Name</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Line Total</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td data-label="Item">
                <span class="item-name">{{ item.item_name }}</span>
            </td>
            <td data-label="Qty">
                <span class="item-quantity">{{ item.quantity }}</span>
            </td>
            <td data-label="Price">
                <span class="item-price">AED {{ item.price|floatformat:2 }}</span>
            </td>
            <td data-label="Total">
                <span class="item-total">AED {{ item.line_total|floatformat:2 }}</span>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4" style="text-align: center; color: var(--text-gray); padding: 40px;">
                <i class="fas fa-inbox" style="font-size: 2rem; opacity: 0.3; display: block; margin-bottom: 12px;"></i>
                No items found in this quotation
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<!-- Summary Section -->
<div class="summary-section">
    <h3 class="summary-title">
        <i class="fas fa-calculator"></i>
        Quotation Summary
    </h3>
    
    <div class="summary-row">
        <span class="summary-label">Subtotal (Excl. Tax):</span>
        <span class="summary-value">AED {{ quotation.total_price|floatformat:2 }}</span>
    </div>
    
    <div class="summary-row">
        <span class="summary-label">Tax :</span>
        <span class="summary-value">
                {{ quotation.tax | default:"5.0"}} %
  
        </span>
    </div>
    
    <div class="summary-row">
        <span class="summary-label">Grand Total (Incl. Tax):</span>
        <span class="summary-value">AED {{ quotation.grand_total|floatformat:2 }}</span>
    </div>
</div>

<!-- Payment Terms Section (if exists) -->
{% if quotation.payment_term %}
<div class="detail-card">
    <h3 class="card-title">
        <i class="fas fa-file-contract"></i>
        Payment Terms & Conditions
    </h3>
    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent-blue);">
        <p style="margin: 0; line-height: 1.6; color: var(--text-dark);">{{ quotation.payment_term|linebreaks }}</p>
    </div>
</div>
{% endif %}

<!-- Additional Actions -->
<div class="detail-card" style="margin-top: 24px;">
    <h3 class="card-title">
        <i class="fas fa-cogs"></i>
        Quick Actions
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
        <button onclick="copyQuotationLink()" class="action-btn btn-outline" style="width: 100%;">
            <i class="fas fa-link"></i>
            Copy Link
        </button>
        
        <!-- <button onclick="emailQuotation()" class="action-btn btn-outline" style="width: 100%;">
            <i class="fas fa-envelope"></i>
            Email to Customer
        </button> -->
        
        <!-- <button onclick="duplicateQuotation()" class="action-btn btn-outline" style="width: 100%;">
            <i class="fas fa-copy"></i>
            Duplicate Quotation
        </button> -->
        

    <a href="/quotation/{{ quotation.id }}/pdf/" class="action-btn btn-outline" style="width: 100%; display: inline-block; text-decoration: none; text-align: center;">
    <i class="fas fa-file-pdf"></i>
    Export to PDF</a>
    </div>


</div>

<!-- Company Footer (for print) -->
<div class="detail-card" style="margin-top: 24px; display: none;" id="companyFooter">
    <div style="text-align: center; color: var(--text-gray); font-size: 0.9rem;">
        <strong>IFEX PR AND ADVERTISING EST</strong><br>
        Phone: 055 831 7409 | Email: sales@ifexprint.com<br>
        Ind. Area 3, Al Qusais, Dubai, UAE
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Copy quotation link to clipboard
function copyQuotationLink() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(function() {
        showNotification('Quotation link copied to clipboard!', 'success');
    }).catch(function(err) {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('Quotation link copied to clipboard!', 'success');
    });
}

// Email quotation functionality
function emailQuotation() {
    const quotationNumber = "{{ quotation.quotation_number }}";
    const customerName = "{{ quotation.customer.name }}";
    const subject = `Quotation ${quotationNumber} from IFEX PR`;
    const body = `Dear ${customerName},\n\nPlease find attached your quotation ${quotationNumber}.\n\nBest regards,\nIFEX PR AND ADVERTISING EST`;
    
    const mailtoLink = `mailto:{{ quotation.customer.email|default:'' }}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    if ("{{ quotation.customer.email }}") {
        window.location.href = mailtoLink;
    } else {
        showNotification('Customer email not found. Please add customer email first.', 'warning');
    }
}

// Duplicate quotation
function duplicateQuotation() {
    if (confirm('Create a duplicate of this quotation?')) {
        // Redirect to create quotation page with current quotation data
        window.location.href = `/quotations/duplicate/{{ quotation.id }}/`;
    }
}

// Export to Excel (basic implementation)
function exportToExcel() {
    showNotification('Preparing Excel export...', 'info');
    
    // Get all the data from HTML data attributes or DOM elements
    const quotationNumber = document.querySelector('[data-quotation-number]').dataset.quotationNumber;
    const customerName = document.querySelector('[data-customer-name]').dataset.customerName;
    const createdAt = document.querySelector('[data-created-at]').dataset.createdAt;
    const deliveryDate = document.querySelector('[data-delivery-date]').dataset.deliveryDate || 'N/A';
    const subtotal = document.querySelector('[data-subtotal]').dataset.subtotal;
    const taxRate = document.querySelector('[data-tax-rate]').dataset.taxRate || '0';
    const taxAmount = document.querySelector('[data-tax-amount]').dataset.taxAmount;
    const grandTotal = document.querySelector('[data-grand-total]').dataset.grandTotal;
    
    // Create CSV content
    let csvContent = "data:text/csv;charset=utf-8,";
    csvContent += `IFEX PR - Quotation ${quotationNumber}\r\n`;
    csvContent += `Customer,${customerName}\r\n`;
    csvContent += `Date,${createdAt}\r\n`;
    csvContent += `Expected Delivery,${deliveryDate}\r\n\r\n`;
    csvContent += "Item Name,Quantity,Unit Price,Line Total\r\n";
    
    // Add items from the table
    document.querySelectorAll('table.items tbody tr').forEach(row => {
        const cols = row.querySelectorAll('td');
        csvContent += `${cols[0].textContent},${cols[1].textContent},${cols[2].textContent},${cols[3].textContent}\r\n`;
    });
    
    csvContent += `\r\nSubtotal,${subtotal}\r\n`;
    csvContent += `Tax (${taxRate}%),${taxAmount}\r\n`;
    csvContent += `Grand Total,${grandTotal}\r\n`;
    
    // Create download link
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `quotation_${quotationNumber}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('Quotation exported successfully!', 'success');
}

// Show notification function
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${getNotificationIcon(type)}"></i>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">×</button>
    `;
    
    // Add notification styles if not already present
    if (!document.querySelector('style[data-notifications]')) {
        const style = document.createElement('style');
        style.setAttribute('data-notifications', 'true');
        style.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 16px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 12px;
                max-width: 400px;
                animation: slideInRight 0.3s ease-out;
            }
            .notification.success { border-left: 4px solid var(--accent-green); }
            .notification.error { border-left: 4px solid var(--danger-color); }
            .notification.warning { border-left: 4px solid var(--accent-orange); }
            .notification button {
                background: none;
                border: none;
                font-size: 18px;
                cursor: pointer;
                opacity: 0.6;
                margin-left: auto;
            }
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @media (max-width: 480px) {
                .notification {
                    right: 10px;
                    left: 10px;
                    max-width: none;
                }
            }
        `;
        document.head.appendChild(style);
    }
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'slideInRight 0.3s ease-out reverse';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

function getNotificationIcon(type) {
    switch (type) {
        case 'success': return 'check-circle';
        case 'error': return 'exclamation-circle';
        case 'warning': return 'exclamation-triangle';
        default: return 'info-circle';
    }
}

// Print functionality
window.addEventListener('beforeprint', function() {
    document.getElementById('companyFooter').style.display = 'block';
});

window.addEventListener('afterprint', function() {
    document.getElementById('companyFooter').style.display = 'none';
});

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth scrolling for back link
    const backLink = document.querySelector('.back-link');
    if (backLink) {
        backLink.addEventListener('click', function(e) {
            // Add a subtle animation when going back
            document.body.style.opacity = '0.8';
            setTimeout(() => {
                window.location.href = this.href;
            }, 150);
        });
    }
    
    // Add loading states to action buttons
    const actionButtons = document.querySelectorAll('.action-btn[href]');
    actionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (this.href && (this.href.includes('pdf') || this.href.includes('excel'))) {
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                this.style.pointerEvents = 'none';
                
                // Restore after 3 seconds
                setTimeout(() => {
                    this.innerHTML = originalHTML;
                    this.style.pointerEvents = 'auto';
                }, 3000);
            }
        });
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + P for print
        if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
            e.preventDefault();
            window.print();
        }
        
        // Ctrl/Cmd + E for edit
        if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
            e.preventDefault();
            const editLink = document.querySelector('a[href*="quotation_edit"]');
            if (editLink) {
                window.location.href = editLink.href;
            }
        }
        
        // Escape to go back
        if (e.key === 'Escape') {
            const backLink = document.querySelector('.back-link');
            if (backLink) {
                window.location.href = backLink.href;
            }
        }
    });
    
    // Add tooltips to action buttons
    const tooltips = {
        'quotation_edit': 'Edit this quotation (Ctrl+E)',
        'create_invoice': 'Convert to invoice',
        'edit_invoice': 'View related invoice',
        'quotation_pdf': 'Download PDF version',
        'print': 'Print quotation (Ctrl+P)'
    };
    
    Object.entries(tooltips).forEach(([key, tooltip]) => {
        const elements = document.querySelectorAll(`[href*="${key}"], [onclick*="${key}"]`);
        elements.forEach(el => {
            el.setAttribute('title', tooltip);
        });
    });
    
    // Show success message if coming from edit page
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('updated') === 'true') {
        showNotification('Quotation updated successfully!', 'success');
    }
});

// Auto-refresh quotation data every 30 seconds (optional)
let autoRefreshInterval;
function toggleAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        console.log('Auto-refresh disabled');
    } else {
        autoRefreshInterval = setInterval(() => {
            // Check if quotation status has changed
            fetch(window.location.href + '?json=true')
                .then(response => response.json())
                .then(data => {
                    if (data.status !== getCurrentStatus()) {
                        showNotification('Quotation status updated! Refreshing page...', 'info');
                        setTimeout(() => location.reload(), 2000);
                    }
                })
                .catch(err => console.log('Auto-refresh error:', err));
        }, 30000);
        console.log('Auto-refresh enabled');
    }
}

function getCurrentStatus() {
    const statusBadge = document.querySelector('.status-badge');
    return statusBadge ? statusBadge.textContent.trim().toLowerCase() : 'unknown';
}

// Calculate and display additional statistics
// function showQuotationStats() {
//     const itemRows = document.querySelectorAll('.items-table tbody tr');
//     const totalItems = itemRows.length;
    
//     if (totalItems > 0) {
//         let totalQuantity = 0;
//         itemRows.forEach(row => {
//             const qtyElement = row.querySelector('.item-quantity');
//             if (qtyElement) {
//                 totalQuantity += parseInt(qtyElement.textContent) || 0;
//             }
//         });
        
//         console.log(`Quotation Stats:
//         - Total Items: ${totalItems}
//         - Total Quantity: ${totalQuantity}
//         - Average Item Value: AED ${({{ quotation.total_price }} / totalItems).toFixed(2)}
//         - Created: {{ quotation.created_at|timesince }} ago`);
//     }
// }

// Initialize stats on load
document.addEventListener('DOMContentLoaded', showQuotationStats);
</script>
{% endblock %}
            